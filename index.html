<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>LPWAN Static Context Header Compression (SCHC) for IPv6 and UDP</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>


  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Vocabulary"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Static Context Header Compression"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Rule id"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Simple Example"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Packet processing"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Matching operators"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Compression Decompression Functions (CDF)"/>
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 not-sent CDF"/>
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 value-sent CDF"/>
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 LSB CDF"/>
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 ESiid-DID, LAiid-DID CDF"/>
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 static-mapping"/>
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 Compute-*"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Application to IPv6 and UDP headers"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Examples"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 IPv6/UDP compression in a star topology"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="9 Normative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.2 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Minaburo, A. and L. Toutain" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-lpwan-ipv6-static-context-hc-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-2-10" />
  <meta name="dct.abstract" content="This document describes a header compression scheme for IPv6, IPv6/UDP based on static contexts. This technique is especially tailored for LPWA networks and could be extended to other protocol stacks." />
  <meta name="description" content="This document describes a header compression scheme for IPv6, IPv6/UDP based on static contexts. This technique is especially tailored for LPWA networks and could be extended to other protocol stacks." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">lpwan Working Group</td>
  <td class="right">A. Minaburo</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Acklio</td>
</tr>
<tr>
  <td class="left">Intended status: Informational</td>
  <td class="right">L. Toutain</td>
</tr>
<tr>
  <td class="left">Expires: August 14, 2017</td>
  <td class="right">IMT-Atlantique</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">February 10, 2017</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">LPWAN Static Context Header Compression (SCHC) for IPv6 and UDP<br />
  <span class="filename">draft-ietf-lpwan-ipv6-static-context-hc-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document describes a header compression scheme for IPv6, IPv6/UDP based on static contexts. This technique is especially tailored for LPWA networks and could be extended to other protocol stacks.</p>
<p>The Static Context Header Compression (SCHC)  offers a great level of flexibility in the processing of fields.  Static context means that values in the context field do not change during the transmission, avoiding complex resynchronization mechanisms, incompatible with LPWA characteristics. In most of the cases, IPv6/UDP headers are reduced to a small identifier.</p>
<p>This document describes the compression/decompression process and apply it to IPv6/UDP headers compression, Other protocols such as CoAP will be described in a separate document.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 14, 2017.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">Headers compression is mandatory to bring the internet protocols to the node within a LPWA network <a href="#I-D.minaburo-lp-wan-gap-analysis">[I-D.minaburo-lp-wan-gap-analysis]</a>.</p>
<p id="rfc.section.1.p.2">Some LPWA networks properties can be exploited for an efficient header compression:</p>
<p/>

<ul>
  <li>Topology is star oriented, therefore all the packets follows the same path.  For the needs of this draft, the architecture can be summarized to End-Systems (ES) exchanging information with LPWAN Application Server (LA). The exchange goes through a LPWA Compressors (LC). Both LC maintain a static context for compression.  Static context means that context information is not learned during the exchange.</li>
  <li>Traffic flows are mostly deterministic, since End-Systems embed built-in applications. Contrary to computers or smartphones, new applications cannot be easily installed.</li>
</ul>
<p id="rfc.section.1.p.4">The Static Context Header Compression (SCHC) combines the advantages of RoHC <a href="#RFC5795">[RFC5795]</a> context, which offers a great level of flexibility in the processing of fields, and 6LoWPAN <a href="#RFC4944">[RFC4944]</a> behavior to elide fields that are known from the other side.  Static context means that values in the context field do not change during the transmission, avoiding complex resynchronization mechanisms, incompatible with LPWA characteristics. In most of the cases, IPv6/UDP headers are reduced to a small context identifier.</p>
<p id="rfc.section.1.p.5">The SCHC is indedependant of the LPWAN technology.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#vocabulary" id="vocabulary">Vocabulary</a></h1>
<p/>

<ul>
  <li>CDF: Compression Decompression Function. Function used both to compress a field or to recover its original value in the decompression phase.</li>
  <li>Context: A set of rules used to compress/decompress headers</li>
  <li>ES: End System. Node connected to the LPWAN. ES may implement SCHC.</li>
  <li>LA: LPWAN Application. Application sending/consuming headers to/from the End System.</li>
  <li>LC: LPWAN Compressor. Process in the network compression/decompressing headers. LC uses SCHC rules to perfom compression decompression.</li>
  <li>MO: Matching Operator. Operator used to compare a value contained in a field&#8217;s header with a value contained in a rule.</li>
  <li>Rule: A set of header field values.</li>
  <li>Rule ID: An identifier for a rule, LC and ES share the same rule ID for a specific flow. Rule ID is sent on the LPWAN.</li>
  <li>TV: Target value. Value contained in the rule that will be matched with the value of an header field.</li>
</ul>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#static-context-header-compression" id="static-context-header-compression">Static Context Header Compression</a></h1>
<p id="rfc.section.3.p.1">Static Context Header Compression (SCHC) avoids context synchronization, which is the most bandwidth-consuming operation in RoHC. Based on the fact that the nature of data flows is highly predictable in LPWA networks, a static context may be stored on the End-System (ES). The other end, the LPWA Compressor (LC) can learn the context through a provisioning protocol during the identification phase (for instance, as it learns the encryption key).</p>
<div id="rfc.figure.1"/>
<div id="Fig-archi"/>
<pre>
           End-System
      +-----------------+
      | APP1  APP2 APP3 |           
      |                 |        
      |       UDP       |       
      |      IPv6       |        
      |                 |       +-----------+         
      |      LC (contxt)|       |LC (contxt)|
      +--------+--------+       +-----+-----+ 
               |                      |
               +~ ~ RG ==== NG =======+
</pre>
<p class="figure">Figure 1: Architecture</p>
<p><a href="#Fig-archi">Figure 1</a> based on <a href="#I-D.ietf-lpwan-overview">[I-D.ietf-lpwan-overview]</a> terminology represent the architecture for compression/decompression. The Thing or End-System is running applications which produce UDP/IPv6 flows. These flows are compressed by a LPWAN Compressor (LC) to reduce the headers size. Resulting information is send on a frame to the LPWAN Radio Network to a Radio Gateway (RG) which forward the frame to a Network Gateway.  The Network Gateway sends the data to a LC for decompression. They both share the same rules. The LC can be located on the Network Gateway or in another places if a tunnel is established between the NG and the LC.  This architecture forms a star topology.</p>
<p id="rfc.section.3.p.3">The context contains a list of rules (cf. <a href="#Fig-ctxt">Figure 2</a>). Each rule contains itself a list of field descriptions composed of a filed id (FID), a target value (TV), a matching operator (MO) and a Compression/Decompression Function (CDF).</p>
<div id="rfc.figure.2"/>
<div id="Fig-ctxt"/>
<pre>
  +------------------------------------------------------------------+
  |                      Rule N                                      |
 +-----------------------------------------------------------------+ |
 |                    Rule i                                       | |
+----------------------------------------------------------------+ | |
|                Rule 1                                          | | |
|+--------+--------------+-------------------+-----------------+ | | |
||Field 1 | Target Value | Matching Operator | Comp/Decomp Fct | | | |
|+--------+--------------+-------------------+-----------------+ | | |
||Field 2 | Target Value | Matching Operator | Comp/Decomp Fct | | | |
|+--------+--------------+-------------------+-----------------+ | | |
||...     |    ...       | ...               | ...             | | | |
|+--------+--------------+-------------------+-----------------+ | |-+
||Field N | Target Value | Matching Operator | Comp/Decomp Fct | | |
|+--------+--------------+-------------------+-----------------+ |-+
|                                                                |
+----------------------------------------------------------------+
</pre>
<p class="figure">Figure 2: Compression Decompression Context</p>
<p id="rfc.section.3.p.4">The rule does not describe the original packet format which must be known from the compressor/decompressor. The rule just describes the compression/decompression behavior for a field.</p>
<p id="rfc.section.3.p.5">The main idea of the compression scheme is to send the rule number (or rule id) to the other end instead of known field values.</p>
<p id="rfc.section.3.p.6">Matching a field with a value and header compression are related operations; If a field matches a rule containing the value, it is not necessary to send it on the link. Since contexts are synchronized, reading the rule&#8217;s value is enough to reconstruct the field&#8217;s value at the other end.</p>
<p id="rfc.section.3.p.7">On some other cases, the value need to be sent on the link to inform the other end. The field value may vary from one packet to another, therefore the field cannot be used to select the rule id. These values are sent in same order as the fields in the rule which defines the structure of the compress header.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#rule-id" id="rule-id">Rule id</a></h1>
<p id="rfc.section.3.1.p.1">Rule id are sent between both compression/decompression element. The size of the rule id is not specified on this document and can vary regarding the LPWAN technology, the number of flows,&#8230;</p>
<p id="rfc.section.3.1.p.2">Some values in the rule id space may be reserved to other goal than header compression, for example fragmentation.</p>
<p id="rfc.section.3.1.p.3">Rule id are specific to an ES. Two ES may use the same rule id for different header compression. The LC needs to combine the rule id with the ES L2 address to find the appropriate rule.</p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#simple-example" id="simple-example">Simple Example</a></h1>
<p id="rfc.section.3.2.p.1">A simple header is composed of 3 fields (F1, F2, F3). The compressor receives a packet containing respectively [F1:0x00, F2:0x1230, F3:0xABC0] in those fields. The Matching Operators (as defined in <a href="#chap-MO">Section 4</a>) allow to select Rule 5 as represented in <a href="#Fig-ex-ctxt">Figure 3</a>; F1 value is ignored and F2 and F3 packet field values are matched with those stored in the rule Target Values.</p>
<div id="rfc.figure.3"/>
<div id="Fig-ex-ctxt"/>
<pre>
               Rule 5
          Target Value   Matching Operator   Comp/Decomp Fct
        +--------------+-------------------+-----------------+
     F1 | 0x00         | Ignore            | not-sent        |
        +--------------+-------------------+-----------------+
     F2 | 0x1230       | Equal             | not-sent        |
        +--------------+-------------------+-----------------+
     F3 | 0xABC0       | Equal             | not-sent        |
        +--------------+-------------------+-----------------+
</pre>
<p class="figure">Figure 3: Matching Rule</p>
<p id="rfc.section.3.2.p.2">The Compression/Decompression Function (as defined in <a href="#chap-CDF">Section 5</a> describes how the fields are compressed. In this example, all the fields are elided and only the rule number has to be sent to the other end.</p>
<p id="rfc.section.3.2.p.3">The decompressor receives the rule number and reconstructs the header using the values stored in the Target Value column.</p>
<p id="rfc.section.3.2.p.4">Note that F1 value will be set to 0x00 by the decompressor, even if the original header field was carrying a different value.</p>
<p id="rfc.section.3.2.p.5">To allow a range of values for field F2 and F3, the MSB() Matching Operator and LSB() Compression/Decompression Function can be used (as defined in <a href="#chap-MO">Section 4</a> and <a href="#chap-CDF">Section 5</a>). In that case the rule will be rewritten as defined in <a href="#Fig-ex-ctxt2">Figure 4</a>.</p>
<div id="rfc.figure.4"/>
<div id="Fig-ex-ctxt2"/>
<pre>
               Rule 5
          Target Value   Matching Operator   Comp/Decomp Fct
        +--------------+-------------------+-----------------+
     F1 | 0x00         | Ignore            | not-sent        |
        +--------------+-------------------+-----------------+
     F2 | 0x1230       | MSB(12)           | LSB(4)          |
        +--------------+-------------------+-----------------+
     F3 | 0xABC0       | MSB(12)           | LSB(4)          |
        +--------------+-------------------+-----------------+
</pre>
<p class="figure">Figure 4: Matching Rule</p>
<p id="rfc.section.3.2.p.6">In that case, if a packet with the following header fields [F1:0x00, F2:0x1234, F3:0xABCD] arrives to the compressor, the new rule 5 will be selected and sent to the other end. The compressed header will be composed of the single byte [0x4D]. The decompressor receives the compressed header and follows the rule to reconstruct [0x00, 0x1234, 0xABCD] applying a OR operator between the target value stored in the rule and the compressed field value sent.</p>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> <a href="#packet-processing" id="packet-processing">Packet processing</a></h1>
<p id="rfc.section.3.3.p.1">The compression/decompression process follows several steps:</p>
<p/>

<ul>
  <li>compression rule selection: the goal is to identify which rule(s) will be used to compress the headers. To each field is associated a matching operator for compression. Each header field&#8217;s value is compared to the corresponding target value stored in the rule for that field using the matching operator. If all the fields in the packet&#8217;s header satisfied the all the matching operators of a rule,  the packet is processed using Compression Decompression Function associated with the fields. Otherwise the next rule is tested. [EDIT]If no eligible rule is found, then the packet is dropped.[EDIT]</li>
  <li>sending: The rule number is sent to the other end followed by data resulting from the field compression. These data are sent in the rule order for the matching fields. The way the rule number is sent depends of the layer two technology and will be specified in a specific document. For exemple, it can either be included in a Layer 2 header or sent in the first byte of the L2 payload.</li>
  <li>decompression: The receiver identifies the  sender through its device-id (e.g. MAC address) and select the appropriate rule through the rule number. This rule gives the compressed header format and associate these values to header fields.  It applies the compression decompression function to reconstruct the original header fields. Compute-* CDFs must be applied after the other CDFs.</li>
</ul>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#chap-MO" id="chap-MO">Matching operators</a></h1>
<p id="rfc.section.4.p.1">This document describes 3 basic matching operators which must be known by both LC. They are not typed and can be applied indifferently to integer, string,&#8230;</p>
<p/>

<ul>
  <li>equal: a field value in a packet matches with a field value in a rule if they are equal.</li>
  <li>ignore: no check is done between a field value in a packet and a field value in the rule. The result is always true.</li>
  <li>MSB(length): a field value of length T in a packet matches with a field value in a rule if the most significant &#8220;length&#8221; bits are equal.</li>
</ul>
<p id="rfc.section.4.p.3">MO may need a list of parameters to proceed to the matching. For instance MSB requires the number of bits to test.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#chap-CDF" id="chap-CDF">Compression Decompression Functions (CDF)</a></h1>
<p id="rfc.section.5.p.1">The Compression Decompression Functions (CDF) describe the action taken during the compression and inversely the action taken by the decompressor to restore the original value.</p>
<div id="rfc.figure.5"/>
<div id="Fig-function"/>
<pre>
/--------------------+-------------+---------------------------\
| Function           | Compression | Decompression             |
|                    |             |                           |
+--------------------+-------------+---------------------------+
|not-sent            |elided       |use value stored in ctxt   |
|value-sent          |send         |build from received value  |
|LSB(length)         |send LSB     |ctxt value OR rcvd value   |
|compute-IPv6-length |elided       |compute IPv6 length        |
|compute-UDP-length  |elided       |compute UDP length         |
|compute-UDP-checksum|elided       |compute UDP checksum       |
|ESiid-DID           |elided       |build IID from L2 ES addr  |
|LAiid-DID           |elided       |build IID from L2 LA addr  |
|static-mapping      |send index   |value form index on a table|
\--------------------+-------------+---------------------------/

</pre>
<p class="figure">Figure 5: Compression and Decompression Functions</p>
<p><a href="#Fig-function">Figure 5</a> lists all the functions defined to compress and decompress a field. The first column gives the function&#8217;s name. The second and third columns outlines the compression/decompression process.</p>
<p id="rfc.section.5.p.3">Compression is done in the rule order and send in that order in the compressed message. The receiver must be able to find the size of each compressed field which can be given by the rule or send with the data.</p>
<h1 id="rfc.section.5.1"><a href="#rfc.section.5.1">5.1.</a> <a href="#not-sent-cdf" id="not-sent-cdf">not-sent CDF</a></h1>
<p id="rfc.section.5.1.p.1">Not-sent function is generally used when the field value is specified in the rule and therefore known by the both sides. This function is generally used with the &#8220;equal&#8221; MO. If MO is &#8220;ignore&#8221;, there is a risk to have a decompressed field value different from the compressed field.</p>
<p id="rfc.section.5.1.p.2">The compressor do not sent any value on the compressed header for that field.</p>
<p id="rfc.section.5.1.p.3">The decompressor restores the field value with the target value stored in the matched rule.</p>
<h1 id="rfc.section.5.2"><a href="#rfc.section.5.2">5.2.</a> <a href="#value-sent-cdf" id="value-sent-cdf">value-sent CDF</a></h1>
<p id="rfc.section.5.2.p.1">Value-sent function is generally used when the field value is not known by both end.  The value is sent in the compressed message header. Both ends must know the size of the field, either implicitely or explicitely in the compressed header field. This function is generally used with the ignore MO.</p>
<p id="rfc.section.5.2.p.2">The compressor sends the target value stored on the rule on the compressed header message. , if the matching operator is &#8220;=&#8221;. Otherwise the matching operator indicates the information that will be sent on the link.</p>
<p id="rfc.section.5.2.p.3">For a LSB operator only the Least Significant Bits are sent.</p>
<h1 id="rfc.section.5.3"><a href="#rfc.section.5.3">5.3.</a> <a href="#lsb-cdf" id="lsb-cdf">LSB CDF</a></h1>
<p id="rfc.section.5.3.p.1">LSB function is used to send a fixed part of the packet field header to the other end.  This function is used in conjuction with the &#8220;MSB&#8221; MO</p>
<p id="rfc.section.5.3.p.2">The compressor sends the &#8220;length&#8221; Least Significant Bits. The decompressor combines with a OR operator the value received with the Target Value.</p>
<h1 id="rfc.section.5.4"><a href="#rfc.section.5.4">5.4.</a> <a href="#esiid-did-laiid-did-cdf" id="esiid-did-laiid-did-cdf">ESiid-DID, LAiid-DID CDF</a></h1>
<p id="rfc.section.5.4.p.1">These functions are used to process respectively the End System and the LA Device Identifier (DID).</p>
<p id="rfc.section.5.4.p.2">The IID value is computed from device ID present in the Layer 2 header. The computation depends on the technology and the device ID  size.</p>
<p id="rfc.section.5.4.p.3">[[NOTE: Behavoir must be more clearly defined. Most technologies have only a single L2 address corresponding the ESiid. LoRaWAN has a changing L2 address, SigFox is stable, but both also have a EUI-64 which could be better to used.]]</p>
<h1 id="rfc.section.5.5"><a href="#rfc.section.5.5">5.5.</a> <a href="#static-mapping" id="static-mapping">static-mapping</a></h1>
<p id="rfc.section.5.5.p.1">The goal of static-mapping is to reduce the size of a field by allocating shorter value. The mapping is known by both ends and stored in a table in both end contexts.</p>
<p id="rfc.section.5.5.p.2">[[NOTE: specify when the mapping is not found]]</p>
<h1 id="rfc.section.5.6"><a href="#rfc.section.5.6">5.6.</a> <a href="#compute-" id="compute-">Compute-*</a></h1>
<p id="rfc.section.5.6.p.1">These functions compute the field value based on received information. They are elided during the compression and reconstructed during the decompression.</p>
<p/>

<ul>
  <li>compute-ipv6-length: compute the IPv6 length field as described in <a href="#RFC2460">[RFC2460]</a>.</li>
  <li>compute-udp-length: compute the IPv6 length field as described in <a href="#RFC0768">[RFC0768]</a>.</li>
  <li>compute-udp-checksum: compute the IPv6 length field as described in <a href="#RFC0768">[RFC0768]</a>.</li>
</ul>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#application-to-ipv6-and-udp-headers" id="application-to-ipv6-and-udp-headers">Application to IPv6 and UDP headers</a></h1>
<div id="rfc.figure.6"/>
<div id="Fig--possible-function"/>
<pre>
/--------------+-------------------+-----------------------------------\
| Field        |Comp Decomp Fct    | Behavior                          |
+--------------+-------------------+-----------------------------------+
|IPv6 version  |not-sent           |The value is not sent, but each    |
|IPv6 DiffServ |                   |end agrees on a value, which can   |
|IPv6 FL       |                   |be different from 0.               |
|IPv6 NH       |value-sent         |Depending on the matching operator,|
|              |                   |the entire field value is sent or  |
|              |                   |an adjustment to the context value |
+--------------+-------------------+-----------------------------------+
|IPv6 Length   |compute-IPv6-length|Dedicated fct to reconstruct value |
+--------------+-------------------+-----------------------------------+
|IPv6 Hop Limit|not-sent+MO=ignore |The receiver takes the value stored|
|              |                   |in the context. It may be different|
|              |                   |from one originally sent, but in a |
|              |                   |star topology, there is no risk of |
|              |                   |loops                              |
|              |not-sent+matching  |Receiver and sender agree on a     |
|              |                   |specific value.                    |
|              |value-sent         |Explicitly sent                    |
+--------------+-------------------+-----------------------------------+
|IPv6 ESPrefix |not-sent           |The 64 bit prefix is stored on     |
|IPv6 LAPrefix |                   |the context                        |
|              |value-sent         |Explicitly send 64 bits on the link|
+--------------+-------------------+-----------------------------------+
|IPv6 ESiid    |not-sent           |IID is not sent, but stored in the |
|IPv6 LAiid    |                   |context                            |
|              |ESiid-DID|LAiid-DID|IID is built from the ES/LA Dev. ID|
|              |value-sent         |IID is explicitly sent on the link.|
|              |                   |Size depends of the L2 technology  |
+--------------+-------------------+-----------------------------------+
|UDP ESport    |not-sent           |In the context                     |
|UDP LAport    |value-sent         |Send the 2 bytes of the port number|
|              |LSB(length)        |or least significant bits if MSB   |
|              |                   |matching is specified in the       |
|              |                   |matching operator.                 |
+--------------+-------------------+-----------------------------------+
|UDP length    |compute-UDP-length |Dedicated fct to reconstruct value |
+--------------+-------------------+-----------------------------------+
|UDP Checksum  |compute-UDP-checksum|Dedicated fct to reconstruct value|
+--------------+-------------------+-----------------------------------+
</pre>
<p class="figure">Figure 6: SCHC functions' example assignment for IPv6 and UDP</p>
<p><a href="#Fig--possible-function">Figure 6</a> gives an example of function assignment to IPv6/UDP fields.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#compressIPv6" id="compressIPv6">Examples</a></h1>
<p id="rfc.section.7.p.1">This section gives some scenarios of the compression mechanism for IPv6/UDP.  The goal is to illustrate the SCHC behavior.</p>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> <a href="#ipv6udp-compression-in-a-star-topology" id="ipv6udp-compression-in-a-star-topology">IPv6/UDP compression in a star topology</a></h1>
<p id="rfc.section.7.1.p.1">The most common case will be a LPWA end-system embeds some applications running over CoAP. In this example, the first flow is for the device management based on CoAP using Link Local addresses and UDP ports 123 and 124.  The second flow will be a CoAP server for measurements done by the end-system (using ports 5683) and Global Addresses alpha::IID/64 to beta::1/64.  The last flow is for legacy applications using different ports numbers, the destination is gamma::1/64.</p>
<p><a href="#FigStack">Figure 7</a> presents the protocol stack for this end-system. IPv6 and UDP are represented with dotted lines since these protocols are compressed on the radio link.</p>
<div id="rfc.figure.7"/>
<div id="FigStack"/>
<pre>
 Managment    Data
+----------+---------+---------+
|   CoAP   |  CoAP   | legacy  |
+----||----+---||----+---||----+
.   UDP    .  UDP    |   UDP   |
................................
.   IPv6   .  IPv6   .  IPv6   .
+------------------------------+
|      6LPWA L2 technologies   |
+------------------------------+
      End System or LPWA GW

</pre>
<p class="figure">Figure 7: Simplified Protocol Stack for LP-WAN</p>
<p id="rfc.section.7.1.p.3">Note that in some LPWA technologies, only End Systems have a device ID.  Therefore it is necessary to define statically an IID for the Link Local address for the LPWA Compressor.</p>
<div id="rfc.figure.8"/>
<div id="Fig-fields"/>
<pre>
  Rule 0
  +----------------+---------+--------+-------------++------+
  | Field          | Value   | Match  | Function    || Sent |
  +----------------+---------+----------------------++------+
  |IPv6 version    |6        | equal  | not-sent    ||      |
  |IPv6 DiffServ   |0        | equal  | not-sent    ||      |
  |IPv6 Flow Label |0        | equal  | not-sent    ||      |
  |IPv6 Length     |         | ignore | comp-IPv6-l ||      |
  |IPv6 Next Header|17       | equal  | not-sent    ||      |
  |IPv6 Hop Limit  |255      | ignore | not-sent    ||      |
  |IPv6 ESprefix   |FE80::/64| equal  | not-sent    ||      |
  |IPv6 ESiid      |         | ignore | ESiid-DID   ||      |
  |IPv6 LCprefix   |FE80::/64| equal  | not-sent    ||      |
  |IPv6 LAiid      |::1      | equal  | not-sent    ||      |
  +================+=========+========+=============++======+
  |UDP ESport      |123      | equal  | not-sent    ||      |
  |UDP LAport      |124      | equal  | not-sent    ||      |
  |UDP Length      |         | ignore | comp-UDP-l  ||      |
  |UDP checksum    |         | ignore | comp-UDP-c  ||      |
  +================+=========+========+=============++======+

  Rule 1
  +----------------+---------+--------+-------------++------+
  | Field          | Value   | Match  | Function    || Sent |
  +----------------+---------+--------+-------------++------+
  |IPv6 version    |6        | equal  | not-sent    ||      |
  |IPv6 DiffServ   |0        | equal  | not-sent    ||      |
  |IPv6 Flow Label |0        | equal  | not-sent    ||      |
  |IPv6 Length     |         | ignore | comp-IPv6-l ||      |
  |IPv6 Next Header|17       | equal  | not-sent    ||      |
  |IPv6 Hop Limit  |255      | ignore | not-sent    ||      |
  |IPv6 ESprefix   |alpha/64 | equal  | not-sent    ||      |
  |IPv6 ESiid      |         | ignore | ESiid-DID   ||      |
  |IPv6 LAprefix   |beta/64  | equal  | not-sent    ||      |
  |IPv6 LAiid      |::1000   | equal  | not-sent    ||      |
  +================+=========+========+=============++======+
  |UDP ESport      |5683     | equal  | not-sent    ||      |
  |UDP LAport      |5683     | equal  | not-sent    ||      |
  |UDP Length      |         | ignore | comp-UDP-l  ||      |
  |UDP checksum    |         | ignore | comp-UDP-c  ||      |
  +================+=========+========+=============++======+

  Rule 2
  +----------------+---------+--------+-------------++------+
  | Field          | Value   | Match  | Function    || Sent |
  +----------------+---------+--------+-------------++------+
  |IPv6 version    |6        | equal  | not-sent    ||      |
  |IPv6 DiffServ   |0        | equal  | not-sent    ||      |
  |IPv6 Flow Label |0        | equal  | not-sent    ||      |
  |IPv6 Length     |         | ignore | comp-IPv6-l ||      |
  |IPv6 Next Header|17       | equal  | not-sent    ||      |
  |IPv6 Hop Limit  |255      | ignore | not-sent    ||      |
  |IPv6 ESprefix   |alpha/64 | equal  | not-sent    ||      |
  |IPv6 ESiid      |         | ignore | ESiid-DID   ||      |
  |IPv6 LAprefix   |gamma/64 | equal  | not-sent    ||      |
  |IPv6 LAiid      |::1000   | equal  | not-sent    ||      |
  +================+=========+========+=============++======+
  |UDP ESport      |8720     | MSB(12)| LSB(4)      || lsb  |
  |UDP LAport      |8720     | MSB(12)| LSB(4)      || lsb  |
  |UDP Length      |         | ignore | comp-UDP-l  ||      |
  |UDP checksum    |         | ignore | comp-UDP-c  ||      |
  +================+=========+========+=============++======+


</pre>
<p class="figure">Figure 8: Context rules</p>
<p id="rfc.section.7.1.p.4">All the fields described in the three rules <a href="#Fig-fields">Figure 8</a> are present in the IPv6 and UDP headers.  The ESDevice-ID value is found in the L2 header.</p>
<p id="rfc.section.7.1.p.5">The second and third rules use global addresses. The way the ES learn the prefix is not in the scope of the document. One possible way is to use a management protocol to set up in both end rules the prefix used on the LPWA network.</p>
<p id="rfc.section.7.1.p.6">The third rule compresses port numbers on 4 bits. This value is selected to maintain alignment on byte boundaries for the compressed header.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.8.p.1">Thanks to Dominique Barthel, Arunprabhu Kandasamy, Antony Markovski, Alexander Pelov, Juan Carlos Zuniga for useful design consideration.</p>
<h1 id="rfc.references"><a href="#rfc.references">9.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-lpwan-overview">[I-D.ietf-lpwan-overview]</b>
      </td>
      <td class="top"><a>Farrell, S.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-lpwan-overview-00">LPWAN Overview</a>", Internet-Draft draft-ietf-lpwan-overview-00, December 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.minaburo-lp-wan-gap-analysis">[I-D.minaburo-lp-wan-gap-analysis]</b>
      </td>
      <td class="top"><a>Minaburo, A.</a>, <a>Pelov, A.</a> and <a>L. Toutain</a>, "<a href="http://tools.ietf.org/html/draft-minaburo-lp-wan-gap-analysis-01">LP-WAN GAP Analysis</a>", Internet-Draft draft-minaburo-lp-wan-gap-analysis-01, February 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC0768">[RFC0768]</b>
      </td>
      <td class="top"><a>Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc768">User Datagram Protocol</a>", STD 6, RFC 768, DOI 10.17487/RFC0768, August 1980.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2460">[RFC2460]</b>
      </td>
      <td class="top"><a>Deering, S.</a> and <a>R. Hinden</a>, "<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>", RFC 2460, DOI 10.17487/RFC2460, December 1998.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4944">[RFC4944]</b>
      </td>
      <td class="top"><a>Montenegro, G.</a>, <a>Kushalnagar, N.</a>, <a>Hui, J.</a> and <a>D. Culler</a>, "<a href="http://tools.ietf.org/html/rfc4944">Transmission of IPv6 Packets over IEEE 802.15.4 Networks</a>", RFC 4944, DOI 10.17487/RFC4944, September 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4997">[RFC4997]</b>
      </td>
      <td class="top"><a>Finking, R.</a> and <a>G. Pelletier</a>, "<a href="http://tools.ietf.org/html/rfc4997">Formal Notation for RObust Header Compression (ROHC-FN)</a>", RFC 4997, DOI 10.17487/RFC4997, July 2007.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5795">[RFC5795]</b>
      </td>
      <td class="top"><a>Sandlund, K.</a>, <a>Pelletier, G.</a> and <a>L-E. Jonsson</a>, "<a href="http://tools.ietf.org/html/rfc5795">The RObust Header Compression (ROHC) Framework</a>", RFC 5795, DOI 10.17487/RFC5795, March 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6282">[RFC6282]</b>
      </td>
      <td class="top"><a>Hui, J.</a> and <a>P. Thubert</a>, "<a href="http://tools.ietf.org/html/rfc6282">Compression Format for IPv6 Datagrams over IEEE 802.15.4-Based Networks</a>", RFC 6282, DOI 10.17487/RFC6282, September 2011.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ana Minaburo</span> 
	  <span class="n hidden">
		<span class="family-name">Minaburo</span>
	  </span>
	</span>
	<span class="org vcardline">Acklio</span>
	<span class="adr">
	  <span class="vcardline">2bis rue de la Chataigneraie</span>

	  <span class="vcardline">
		<span class="locality">35510 Cesson-Sevigne Cedex</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ana@ackl.io">ana@ackl.io</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Laurent Toutain</span> 
	  <span class="n hidden">
		<span class="family-name">Toutain</span>
	  </span>
	</span>
	<span class="org vcardline">IMT-Atlantique</span>
	<span class="adr">
	  <span class="vcardline">2 rue de la Chataigneraie</span>
<span class="vcardline">CS 17607</span>

	  <span class="vcardline">
		<span class="locality">35576 Cesson-Sevigne Cedex</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Laurent.Toutain@imt-atlantique.fr">Laurent.Toutain@imt-atlantique.fr</a></span>

  </address>
</div>
  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Vocabulary</a></li>
<li>3.   <a href="#rfc.section.3">Static Context Header Compression</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Rule id</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Simple Example</a></li>
<li>3.3.   <a href="#rfc.section.3.3">Packet processing</a></li>
</ul><li>4.   <a href="#rfc.section.4">Matching operators</a></li>
<li>5.   <a href="#rfc.section.5">Compression Decompression Functions (CDF)</a></li>
<ul><li>5.1.   <a href="#rfc.section.5.1">not-sent CDF</a></li>
<li>5.2.   <a href="#rfc.section.5.2">value-sent CDF</a></li>
<li>5.3.   <a href="#rfc.section.5.3">LSB CDF</a></li>
<li>5.4.   <a href="#rfc.section.5.4">ESiid-DID, LAiid-DID CDF</a></li>
<li>5.5.   <a href="#rfc.section.5.5">static-mapping</a></li>
<li>5.6.   <a href="#rfc.section.5.6">Compute-*</a></li>
</ul><li>6.   <a href="#rfc.section.6">Application to IPv6 and UDP headers</a></li>
<li>7.   <a href="#rfc.section.7">Examples</a></li>
<ul><li>7.1.   <a href="#rfc.section.7.1">IPv6/UDP compression in a star topology</a></li>
</ul><li>8.   <a href="#rfc.section.8">Acknowledgements</a></li>
<li>9.   <a href="#rfc.references">Normative References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  

  <div class="github-fork-ribbon-wrapper"><div class="github-fork-ribbon"><a href="https://github.com/lp-wan/ip-compression">Fork me on GitHub</a></div></div>
</body>
</html>
